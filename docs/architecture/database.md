# üóÑÔ∏è Database Schema

DocBuilder uses **Google Cloud Firestore**, a NoSQL document database. Data is structured in collections and documents.

## Collections

### 1. `users`
Stores user profile information.
- **Document ID**: `uid` (from Firebase Auth)
- **Fields**:
    - `email` (string): User's email.
    - `display_name` (string): User's full name.
    - `created_at` (timestamp): Account creation time.
    - `updated_at` (timestamp): Last profile update.

### 2. `projects`
Stores all project data, including the document outline and content.
- **Document ID**: UUID (generated by backend)
- **Fields**:
    - `title` (string): Project title.
    - `owner_uid` (string): ID of the user who owns the project.
    - `doc_type` (string): 'docx' or 'pptx'.
    - `created_at` (timestamp).
    - `updated_at` (timestamp).
    - `outline` (array of objects): The core document structure.
    - `generation_history` (array of objects): Log of AI operations.

## Data Models

### Section Object (inside `outline` array)
Each section in the `outline` array has the following structure:

```json
{
  "id": "uuid-string",
  "title": "Section Title",
  "word_count": 300,
  "status": "queued | generating | done | failed",
  "content": "HTML content string...",
  "bullets": ["Key point 1", "Key point 2"],
  "version": 1,
  "refinement_history": [
    {
      "id": "uuid",
      "prompt": "Make it shorter",
      "diff_summary": "Reduced word count by 20%",
      "created_at": "timestamp",
      "likes": ["uid1"],
      "dislikes": []
    }
  ]
}
```

### Generation History Object
Logs global generation events for the project.

```json
{
  "timestamp": "timestamp",
  "prompt": "Generate section 'Introduction'",
  "model_meta": {
    "provider": "gemini"
  },
  "hash": "sha256-hash"
}
```

## Indexing
- **Compound Indexes**:
    - `projects`: `owner_uid` ASC, `updated_at` DESC (for listing projects efficiently).
